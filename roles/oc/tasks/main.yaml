---
- name: Create bin dir
  file:
    state: directory
    path: "{{ workspace }}/bin/"

- name: Get openshift clients
  get_url:
    url: "https://mirror.openshift.com/pub/openshift-v4/clients/ocp/{{ openshift.install_version }}/openshift-client-linux-{{ openshift.install_version }}.tar.gz"
    dest: "/tmp/oc.tar.gz"

- name: Get openshift installer
  get_url:
    url: "https://mirror.openshift.com/pub/openshift-v4/clients/ocp/{{ openshift.install_version }}/openshift-install-linux-{{ openshift.install_version }}.tar.gz"
    dest: "/tmp/installer.tar.gz"

- name: Extract Openshift clients
  unarchive:
    src: "/tmp/oc.tar.gz"
    dest: "{{ workspace }}/bin/"
    remote_src: yes
    include:
      - oc
    selevel: s0
    serole: object_r
    setype: bin_t
    seuser: system_u
    mode: 0755

- name: Extract Openshift installer
  unarchive:
    src: "/tmp/installer.tar.gz"
    dest: "{{ workspace }}/bin/"
    remote_src: yes
    selevel: s0
    serole: object_r
    setype: bin_t
    seuser: system_u
    mode: 0755

- name: Symlink kubectl
  file:
    state: link
    src: "{{ workspace }}/bin/oc"
    dest: "{{ workspace }}/bin/kubectl"
      
